Building powerful data-apps requires time and the integration of multiple tools. Dozer is an open-source platform that gives you a simple platform to transform, cache and integrate data into your applications.

## ‚ö° What's Dozer?

Dozer solves the problem of fragmented data by offering a unified API layer that consolidates data from various sources. It alleviates the read load on operational databases and simplifies data integration. 

This solution enables businesses to unlock the value of their data, improve system performance, and make informed decisions.

üëÄ Take a look at the below image.
![[SCR-20230608-mdll.png]]

It's as simple as a single `YAML` file configuration. With just that, you can effortlessly create real-time data apps.

## ü§î Why Dozer?
Dozer effectively addresses three main challenges:

- Dozer provides a simple solution to solve complex problems.
- It simplifies the process of connecting databases and tracking changes.
- Dozer makes it easier to manage and work with database systems efficiently.

Okay, now lets build a quick ecommerce app with SvelteKit & Dozer.

## ‚¨áÔ∏è Installing Dozer

To work with Dozer, you first need to install the Dozer client on your computer. Here's how you can do it:

- Installation process

Run the following command. 
```bash
Dozer version command```

This will confirm that the Dozer client has been successfully installed on your computer. Now let's setup database & config file to start working with dozer.

## üóÑÔ∏è  Setting up database

Create a new instance of PostgreSQL. You can either create it on your local machine or use a managed database service like Supabase, Neon, or Railway.

Your provision url will look like this:
```.env
postgresql://[database]:[password]@localhost:5432/postgres
```

Now open the query console, Copy and paste the seed queries provided below.

This will create a necessary table for our Dozlog application.

```seed.sql

CREATE TABLE IF NOT EXISTS profile (
id VARCHAR(255) PRIMARY KEY,
name VARCHAR(255),
email VARCHAR(255) NOT NULL,
"emailVerified" TIMESTAMP,
image VARCHAR(255)
);

CREATE TABLE IF NOT EXISTS account (
id VARCHAR(255) PRIMARY KEY,
"userId" VARCHAR(255) NOT NULL,
type VARCHAR(255) NOT NULL,
provider VARCHAR(255) NOT NULL,
"providerAccountId" VARCHAR(255) NOT NULL,
refresh_token VARCHAR(255),
access_token VARCHAR(255),
expires_at BIGINT,
token_type VARCHAR(255),
scope VARCHAR(255),
id_token VARCHAR(255),
session_state VARCHAR(255),
oauth_token_secret VARCHAR(255),
oauth_token VARCHAR(255)
);


CREATE TABLE IF NOT EXISTS session (
id VARCHAR(255) PRIMARY KEY,
"sessionToken" VARCHAR(255) NOT NULL,
expires TIMESTAMP NOT NULL,
userId VARCHAR(255) NOT NULL
);

CREATE TABLE IF NOT EXISTS verificationToken (
identifier VARCHAR(255) NOT NULL,
token VARCHAR(255) NOT NULL,
expires TIMESTAMP NOT NULL
);

CREATE TABLE IF NOT EXISTS product (
id VARCHAR(255) PRIMARY KEY,
name VARCHAR(255) NOT NULL,
description VARCHAR(255),
price DECIMAL(10, 2) NOT NULL,
image VARCHAR(512) NOT NULL,
userId VARCHAR(255) NOT NULL,
createdAt TIMESTAMP,
updatedAt TIMESTAMP NOT NULL
);

CREATE TABLE IF NOT EXISTS cart (
id VARCHAR(255) PRIMARY KEY,
userId VARCHAR(255) NOT NULL,
productId VARCHAR(255) NOT NULL,
quantity INT,
createdAt TIMESTAMP,
updatedAt TIMESTAMP NOT NULL
);

CREATE TABLE orders (
id VARCHAR(255) PRIMARY KEY,
userId VARCHAR(255) NOT NULL,
productId VARCHAR(255) NOT NULL,
quantity INT NOT NULL,
totalPrice INT NOT NULL,
createdAt TIMESTAMP NOT NULL,
updatedAt TIMESTAMP NOT NULL
);

INSERT INTO "Product" (id, name, description, price, "userId", "createdAt", "updatedAt")

VALUES ('23323232', 'Dummy Product', null, 10.99, '7pI_uRRxAmhhg7XCLICNF', '2022-02-22 00:00:00', '2022-02-22 00:00:00');

  

ALTER TABLE product

ALTER COLUMN price TYPE numeric(10,2) USING price::numeric(10,2);

ALTER TABLE product ALTER COLUMN price TYPE INTEGER USING price::INTEGER;
```

Now we have successfully created table & inserted dummy data for our Dozlog application. Let's how to configure Dozer with Postgres.


## üíª  Let's configure Dozer YAML file.

Dozer works with just a single yaml file. In order to get started create a new file called `dozer-config.yaml`  you can name it as per your wish.

Open the file & paste the below configuration.

```dozer.yaml
cache_max_map_size: 2147483648
connections:
- name: stic_conn
config: !Postgres
user: spikey
password: sticai123
host: localhost
port: 5432
database: postgres

  

sql: |
SELECT
SUM(p.price * c.quantity) AS total_cart_value,
5.32 AS shipping_est,
9.45 AS tax_est,
SUM(p.price * c.quantity) + 5.00 + 8.32 AS total_cart_value_with_tax,
COUNT(*) AS total_items,
5.32 * COUNT(*) AS total_shipping,
9.45 * COUNT(*) AS total_tax
INTO cart_count
FROM cart c
JOIN product p ON c."productId" = p.id;


SELECT
SUM("totalPrice") AS total_price,
SUM(quantity) AS total_quantity,
COUNT(DISTINCT "userId") AS unique_users_count,
ROUND(CAST(SUM(quantity) AS FLOAT) / COUNT(DISTINCT "userId")) AS avg_order_per_user
INTO order_count
FROM "order";
SELECT * FROM into allproducts "product";

sources:
- name: product
table_name: product
connection: !Ref stic_conn
columns:

- name: cart
table_name: cart
connection: !Ref stic_conn
columns:

- name: profile
table_name: profile
connection: !Ref stic_conn

columns:
- name: order
table_name: order
connection: !Ref stic_conn
columns:


endpoints:
- name: product
path: /product
table_name: product

- name: cart
path: /cart
table_name: cart

- name: profile
path: /profile
table_name: profile

- name: order
path: /order
table_name: order
  
- name: cart_count
path: /cart_count
table_name: cart_count

- name: order_count
path: /order_count
table_name: order_count

- name: allproducts
path: /all_products
table_name: all_products
```


If you see carefully, Dozer yaml file contains 4 core configuration. They are 
- Connection
- Sql
- Sources
- Endpoints

These 4 founding pillars are used to configure the Dozer in order to communicate with our Postgres database.

### üåê Connections
Connections are basically used to setup connections for our Postgres database. Here you will define. name & configuration details. For example,

```dozer-config.yaml
connections:
- name: stic_conn
config: !Postgres
user: sanju
password: helloworld
host: localhost
port: 5432
database: postgres
```

Note: One of the impressive features of Dozer is that you can connect multiple Postgres instances within a single Dozer file. This flexibility allows you to seamlessly manage and work with multiple databases using Dozer.


### ‚úçÔ∏è  Sql
The SQL block in Dozer.yaml is used for writing read-only SQL queries. These queries allow you to retrieve data from multiple tables and columns to obtain the desired results. 

For example, you can utilize the SQL block to create aggregation queries that combine data from different tables to perform calculations or generate reports.

To define `Sql` in Dozer, follow these steps:
```dozer-config.yaml
sql: |
SELECT
SUM(p.price * c.quantity) AS total_cart_value,
5.32 AS shipping_est,
9.45 AS tax_est,
SUM(p.price * c.quantity) + 5.00 + 8.32 AS total_cart_value_with_tax,
COUNT(*) AS total_items,
5.32 * COUNT(*) AS total_shipping,
9.45 * COUNT(*) AS total_tax
INTO cart_count
FROM cart c
JOIN product p ON c."productId" = p.id;


SELECT
SUM("totalPrice") AS total_price,
SUM(quantity) AS total_quantity,
COUNT(DISTINCT "userId") AS unique_users_count,
ROUND(CAST(SUM(quantity) AS FLOAT) / COUNT(DISTINCT "userId")) AS avg_order_per_user
INTO order_count
FROM "order";
SELECT * FROM into allproducts "product";
```

Alright, we will discuss this concept in more detail in the upcoming steps. Let's continue with the next topic.


### üï∏Ô∏è Sources
Sources are used to establish a connection between tables and databases. They allow Dozer to track changes specifically for those sources. For example, if you have a database with 10 tables but only want to monitor 7 of them, you will need to define those specific sources for Dozer.

To define sources in `Dozer`, follow these steps:
```dozer-config.yaml

```

### ‚õ≥ Endpoints
Endpoints in Dozer function similarly to REST API endpoints. To create an endpoint, you need to provide a unique name, a path, and the name of the table.

When working with frontend applications or REST APIs, endpoints are essential for retrieving specific results from Dozer.

Endpoints play a crucial role in connecting sources and executing SQL queries. They serve as the bridge between your application and the data you want to access in Dozer.

To define `Endpoints` in Dozer, follow these steps:
```dozer-config.yaml
endpoints:
- name: product
path: /product
table_name: product

- name: cart
path: /cart
table_name: cart

- name: profile
path: /profile
table_name: profile

- name: order
path: /order
table_name: order
  
- name: cart_count
path: /cart_count
table_name: cart_count

- name: order_count
path: /order_count
table_name: order_count

- name: allproducts
path: /all_products
table_name: all_products
```

Now we have successfully setup our Dozer configuration in yaml file. In order to spin up connection. Run the following command.

```bash
dozer -c dozer-config.yaml
```

![[Pasted image 20230616005701.png]]
Once Dozer is running, you will be able to observe the timestamps indicating the duration it took to load each endpoint. This will help you track the performance and response time of each endpoint.

### üåÄ Curl request
Dozer supports Rest API endpoints including documentation support. Here's an example to call endpoints.

```bash
curl -X POST http://localhost:8080/product/query \  
--header 'Content-Type: application/json' \  
--data-raw '{"$limit":3}'

# Response
[{"id":"5","name":"Product 5","description":"Description of product 5","price":50,"image":"https://images.pexels.com/photos/11232184/pexels-photo-11232184.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1","userId":"MWFvqNBYKVf48lSIotq0d","createdAt":"2022-01-05T00:00:05.000Z","updatedAt":"2022-01-05T00:00:05.000Z","__dozer_record_id":0,"__dozer_record_version":1},{"id":"2","name":"Product 2","description":"Description of product 2","price":20,"image":"https://images.pexels.com/photos/1879096/pexels-photo-1879096.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1","userId":"MWFvqNBYKVf48lSIotq0d","createdAt":"2022-01-02T00:00:02.000Z","updatedAt":"2022-01-02T00:00:02.000Z","__dozer_record_id":1,"__dozer_record_version":1},{"id":"4","name":"Product 4","description":"Description of product 4","price":40,"image":"https://images.pexels.com/photos/11281577/pexels-photo-11281577.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1","userId":"MWFvqNBYKVf48lSIotq0d","createdAt":"2022-01-04T00:00:04.000Z","updatedAt":"2022-01-04T00:00:04.000Z","__dozer_record_id":2,"__dozer_record_version":1},{"id":"1","name":"Product 1","description":"Description of product 1","price":10,"image":"https://images.pexels.com/photos/1464625/pexels-photo-1464625.jpeg?auto=compress&cs=tinysrgb&w=1600","userId":"MWFvqNBYKVf48lSIotq0d","createdAt":"2022-01-01T00:00:01.000Z","updatedAt":"2022-01-01T00:00:01.000Z","__dozer_record_id":3,"__dozer_record_version":1},{"id":"3","name":"Product 3","description":"Description of product 3","price":30,"image":"https://images.pexels.com/photos/1879101/pexels-photo-1879101.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1","userId":"MWFvqNBYKVf48lSIotq0d","createdAt":"2022-01-03T00:00:03.000Z","updatedAt":"2022-01-03T00:00:03.000Z","__dozer_record_id":4,"__dozer_record_version":1}]
```
You can learn more about Dozer REST API  from [Using REST APIs | Dozer | Start building real-time data apps in minutes](https://getdozer.io/docs/querying/rest)

Now that you have an idea of how to set up Dozer and understand its functionality, you have all the necessary knowledge. Now, we can shift our focus towards frontend development in order to build Dozlog.

## ‚ö° Building Realtime apps with Dozer & SvelteKit